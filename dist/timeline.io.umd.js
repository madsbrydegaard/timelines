(()=>{var ae=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var B=(y,p,f)=>p in y?ae(y,p,{enumerable:!0,configurable:!0,writable:!0,value:f}):y[p]=f,V=(y,p)=>{for(var f in p||(p={}))me.call(p,f)&&B(y,f,p[f]);if(_)for(var f of _(p))ue.call(p,f)&&B(y,f,p[f]);return y},Y=(y,p)=>le(y,ce(p));var W=(y,p,f)=>{let v,L,M,z,c,m,b,T,H,S,x=[],J=(t,o,l)=>{if(!t)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof t=="string"){let u=document.querySelector(t);if(!u)throw new Error(`Selector could not be found [${c}]`);c=u}t instanceof HTMLElement&&(c=t),m=V({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-1000y",timelineEnd:"100y",minZoom:1,maxZoom:1e11,position:"bottom",expandRatio:80,eventHeight:5},l),console.log(x),x.push(G(o));let[e]=x.slice(-1);M=A(m.timelineStart),z=A(m.timelineEnd);let n=m.viewStart?A(m.viewStart):e.start-e.duration*.05,i=m.viewEnd?A(m.viewEnd):e.end+e.duration*.05;n<M&&(M=n),i>z&&(z=i);let r=i-n;v=$()/r,L=(M-n)/r,console.log(e,new Date(e.start*6e4),new Date(e.end*6e4)),te(),U(c),k()},$=()=>z-M,q=()=>c.offsetWidth||0,X=()=>M-E()*L,O=()=>X()+E(),E=()=>$()/v,F=t=>(t-X())/E(),K=(t,o)=>{let l=v-o;return t===1&&l<=m.minZoom||t===-1&&l>=m.maxZoom?!1:(v=l,!0)},P=t=>{let o=L+t;o>=0&&(o=0),o+v<=1&&(o=1-v),L=o},Z=(t,o)=>{let l=m.zoomSpeed*v,e=t*l,r=((o||0)/q()-L)/v*e;K(t,e)&&P(r),k()},Q=t=>{P(t),k()},j=(t,o)=>{if(!t)return;let l=400,e=t.duration*1.1,n=(M-t.start)/e,i=t.start+t.duration/2,u=F(i)*t.duration,h=t.start+u*.95,w=F(h)*q(),g=0,N=Math.sign(n-L),C=()=>{clearInterval(s),!o&&t.children.length>0&&x.push(t),o&&x.pop(),k()},s=setInterval(()=>{g++>l&&C(),N<0&&L<n&&C(),N>0&&L>n&&C(),Z(N,w)},1)},U=t=>{window.addEventListener("resize",()=>{k()},{passive:!0}),t.addEventListener("wheel",i=>{var r=Math.sign(i.deltaY);let h=(i.target.attributes.starttime?F(i.target.attributes.starttime):0)*t.getBoundingClientRect().width+i.offsetX;Z(r,h)},{passive:!0});let o,l,e=!1,n=!0;t.addEventListener("mousedown",i=>{e=!0,o=i.pageX,l=i.pageY},{passive:!0}),t.addEventListener("mousemove",i=>{if(!e||!n)return;n=!1;let r=(i.pageX-o)*m.dragSpeed;r&&Q(r),o=i.pageX,l=i.pageY,setTimeout(()=>n=!0,10)},{passive:!0}),t.addEventListener("mouseup",()=>{e=!1},{passive:!0})},ee=t=>{let o=document.createDocumentFragment(),l=n=>{if(n.start>=O()||n.end<=X())return;let i=F(n.start),r=document.createElement("div"),u=n.duration/E()*100;return r.style.left=i*100+"%",r.style.width=u+"%",r.style.position="absolute",r.style.minWidth="5px",r.style.overflow="hidden",r.title=n.title,r.className="timelineEventGenerated",r.attributes.starttime=n.start,r.attributes.expanded=u>m.expandRatio,r},e=n=>{let i=document.createElement("div");return i.title=n.title,i.innerText=n.title,i.className="timelineEventGeneratedTitle",i.style.whiteSpace="nowrap",i.style.pointerEvents="none",i.style.userSelect="none",i};return t.children.filter(n=>n.type==="background").forEach((n,i)=>{try{let r=l(n);if(r){let u=n.color.map(h=>h-Math.pow(10,n.depth));r.style.bottom="0px",r.style.minHeight="100%",r.style.backgroundColor=`rgba(${u[0]},${u[1]},${u[2]}, .05)`,r.addEventListener("click",h=>{r.dispatchEvent(new CustomEvent("background-event-click",{detail:n,bubbles:!0}))}),r.append(e(n)),o.appendChild(r)}}catch(r){console.error(r,"backgroundEvent",n)}}),t.children.filter(n=>n.type==="timeline").forEach((n,i)=>{try{let r=l(n);if(r){let u=n.height+(n.height-1)*.5,h=(n.level+t.level-1)*1.5,w=n.color.map(g=>g-Math.pow(10,n.depth));r.style.bottom=`${h*m.eventHeight}px`,r.style.minHeight=`${u*m.eventHeight}px`,r.style.borderRadius="5px",r.style.boxSizing="border-box",r.style.border="1px solid rgba(100,100,100,.5)",r.style.backgroundColor=`rgb(${w[0]},${w[1]},${w[2]})`,r.style.zIndex=n.depth.toString(),r.addEventListener("click",g=>{r.dispatchEvent(new CustomEvent("event-click",{detail:n,bubbles:!0}))}),o.appendChild(r)}}catch(r){console.error(r,"timelineEvent",n)}}),o},te=()=>{c.style.position="relative",c.style.overflow="hidden",c.style.minHeight="3rem";let t=c.querySelector(".timelineHeaderContainer");S=t||document.createElement("div"),t||c.appendChild(S),S.className="timelineHeaderContainer",S.style.width="100%",S.style.height="20px",S.style.backgroundColor="white";let o=c.querySelector(".timelineLabelContainer");switch(b=o||document.createElement("div"),o||c.appendChild(b),b.className="timelineLabelContainer",b.style.width="100%",b.style.height="50px",b.style.textAlign="center",b.style.position="absolute",b.style.pointerEvents="none",b.style.userSelect="none",m.position){case"top":b.style.top="20px";break;default:b.style.bottom="0"}let l=c.querySelector(".timelineDividerContainer");T=l||document.createElement("div"),l||c.appendChild(T),T.className="timelineDividerContainer",T.style.width="100%",T.style.height="calc(100% - 20px)",T.style.position="absolute",T.style.zIndex="-2",T.style.bottom="0";let e=c.querySelector(".timelineEventsContainer");H=e||document.createElement("div"),e||c.appendChild(H),H.className="timelineEventsContainer",H.style.position="absolute",H.style.bottom="50px",H.style.height="calc(100% - 70px)",H.style.width="100%"},ne=t=>{let o=new Date(t*6e4);return E()<5760?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(o):E()<60480?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(o):E()<788923.1502?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short"}).format(o):o.getFullYear().toString()},k=()=>{if(!c)return;let t=Math.floor(v),o=Math.pow(2,Math.floor(Math.log2(t))),l=1/(m.labelCount+1),e=X()-M,i=$()*l/o,u=Math.floor(e/i)*i,h=document.createDocumentFragment(),w=document.createDocumentFragment();for(let a=0;a<m.labelCount+2;a++){let d=(a+1)*i+M+u-i,R=d+i/2,oe=F(d)*100,se=F(R)*100,D=document.createElement("div");D.className="timelineLabel",D.style.left=oe+"%",D.style.top="50%",D.style.transform="translate(calc(-50%), calc(-50%))",D.style.textAlign="center",D.style.position="absolute",D.style.zIndex="-1",D.style.width=l*100+"%",D.innerHTML=ne(d),h.appendChild(D);let I=document.createElement("div");I.className="timelineDivider",I.style.left=se+"%",I.style.textAlign="center",I.style.position="absolute",I.style.height="100%",I.style.zIndex="-10",I.innerHTML="",w.appendChild(I)}b.innerHTML="",b.appendChild(h),T.innerHTML="",T.appendChild(w);let[g]=x.slice(-1),N=ee(g);H.innerHTML="",H.appendChild(N);let C=document.createDocumentFragment(),s=document.createElement("div");if(s.className="timelineHeader",s.style.textAlign="center",s.innerHTML=g.title,C.appendChild(s),x.length>1){let a=document.createElement("div");a.className="timelineBack",a.style.position="absolute",a.style.top="0px",a.style.left="5px",a.style.cursor="pointer",a.innerHTML="<",a.addEventListener("click",d=>{a.dispatchEvent(new CustomEvent("back-click",{bubbles:!0}));let[R]=x.slice(-2);j(R,!0)}),C.appendChild(a)}S.innerHTML="",S.appendChild(C),c.dispatchEvent(new CustomEvent("update",{detail:ie(),bubbles:!0,cancelable:!0,composed:!1}))},A=t=>{if(t===void 0)return;let o=e=>{let n=new Date;if(n.setDate(e[2]?e[2]:1),n.setMonth(e[1]?e[1]-1:0),n.setHours(e[3]?e[3]:0),n.setMinutes(e[4]?e[4]:0),n.setSeconds(0),!e[0])return n.getTime()/6e4;if(e[0]&&e[0]>-27e4&&e[0]<27e4)return n.setFullYear(e[0]),n.getTime()/6e4;let i=525948.766*e[0];return n.setFullYear(0),i+n.getTime()/6e4},l=e=>{switch(e){case"now":return new Date;default:let n=Number(e.replace(/y$/,""));return isNaN(n)?new Date(e):new Date(Date.now()+31556926*1e3*n)}};if(Array.isArray(t)){let e=t;if(e.length===0)throw new Error("argument Array cannot be empty");if(!e.every(i=>typeof i=="number"))throw new Error("input Array must contain only numbers");return o(e)}if(typeof t=="object"&&t.constructor.name==="Date")return t.getTime()/6e4;if(typeof t=="string")return l(t).getTime()/6e4;if(typeof t=="number")return new Date(t).getTime()/6e4},G=(t,o)=>{if(!t){console.warn("Event object is empty");return}let l=s=>s.every(a=>typeof a=="number"),e=Y(V({type:"timeline",duration:0,color:[240,240,240],expanded:!1,level:0,step:0,score:0,height:0,children:[],depth:o?o.depth+1:0},t),{start:A(t.start),end:A(t.end)}),n=t.events?t.events.reduce((s,a)=>{let d=G(a,e);return d&&s.push(d),s},[]):[];e.children=n.sort((s,a)=>s.start-a.start);let i=e.start?e.children.length?Math.min(e.start,e.children[0].start):e.start:e.children.length?e.children[0].start:void 0;if(!i){console.warn("Missing start property on event - skipping",t);return}let r=e.end?e.end:e.duration&&!isNaN(Number(e.duration))?i+Number(e.duration):e.children.length&&e.children[e.children.length-1].end||i+1,u=t.color?l(t.color)?t.color:[240,240,240]:[240,240,240],h={1:{height:0,time:Number.MIN_SAFE_INTEGER}},w=s=>{let a=0;for(let d in h)if(a=Number(d),s.start>h[d].time){for(let R=0;R<s.height;R++)h[(a+R).toString()]={height:s.height,time:s.end};return a}a++;for(let d=0;d<s.height;d++)h[(a+d).toString()]={height:s.height,time:s.end};return a},g={1:{height:0,time:Number.MIN_SAFE_INTEGER}},N=s=>{let a=0;for(let d in g)if(a=Number(d),s.start>g[d].time)return g[a.toString()]={height:s.height,time:s.end},a;return a++,g[a.toString()]={height:s.height,time:s.end},a},C=s=>{let a=1;return a=(s.duration||1)/$()*e.children.length,a};return e.children.forEach((s,a)=>{s.score=C(s),s.level=s.type==="timeline"?w(s):0,s.step=s.type==="timeline"?N(s):0}),e.type=t.type||"timeline",e.duration=r-i,e.color=u,e.start=i,e.end=r,e.height=n.length?Math.max.apply(1,n.map(s=>s.level)):1,e},re=t=>{let o=[],l=t.querySelectorAll(".timelineEvent");return l&&l.forEach(e=>{try{o.push(Y(V({},e.attributes),{events:re(e)}))}catch(n){console.error(n,"timelineEvent")}}),o},ie=()=>({options:m,viewStartDate:X(),viewEndDate:O(),viewDuration:E(),ratio:v,pivot:L});return J(y,p,f),{focus:j}};window.Timeline=W;})();
