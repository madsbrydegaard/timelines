(()=>{var pe=Object.defineProperty,ye=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var te=(v,b,c)=>b in v?pe(v,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):v[b]=c,A=(v,b)=>{for(var c in b||(b={}))ve.call(b,c)&&te(v,c,b[c]);if(ee)for(var c of ee(b))we.call(b,c)&&te(v,c,b[c]);return v},j=(v,b)=>ye(v,Te(b));var ne=(v,b)=>{let c,I,M,V,m,h,p,C,L,x,q=[],Y,N,re=e=>{if(!e)throw new Error("Event argument is empty. Please provide Timeline event as first arg");Q(N,e),k()},Ce=e=>e.start<E()&&e.end>w(),De=e=>e.start>w()&&e.end<E(),O=e=>e.start<w()&&e.end>E(),Me=e=>e.duration>y(),ie=(e,i)=>{if(!e)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof e=="string"){let a=document.querySelector(e);if(!a)throw new Error(`Selector could not be found [${m}]`);m=a}e instanceof HTMLElement&&(m=e),h=A({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-270000",timelineEnd:"1000y",start:"-1000y",end:"100y",minZoom:1,maxZoom:1e11,position:"bottom",expandRatio:80,eventHeight:5},i),N=U({title:"View",type:"container",start:h.start,end:h.end}),M=z(h.timelineStart),V=z(h.timelineEnd);let r=N.start,t=N.end;r<M&&(M=r),t>V&&(V=t);let n=t-r;c=R()/n,I=(M-r)/n,Y=N,ue(),de(m),k()},oe=()=>{if(q.length){let[e]=q.slice(-1);return e}},R=()=>V-M,se=()=>m.offsetWidth||0,w=()=>M-y()*I,E=()=>w()+y(),y=()=>R()/c,ae=()=>h.zoomSpeed*c,S=e=>(e-w())/y(),B=e=>(e-M)/R(),le=(e,i)=>{let r=c-i;return e===1&&r<=h.minZoom||e===-1&&r>=h.maxZoom?!1:(c=r,!0)},G=e=>{let i=I+e;i>=0&&(i=0),i+c<=1&&(i=1-c),I=i},W=(e,i)=>{let r=e*ae(),t=i*r;le(e,r)&&G(t),k()},Z=e=>{G(e*h.dragSpeed),k()},ce=e=>{if(!e)return;let i=0,r=e.start-e.duration*.05,n=e.end+e.duration*.05-r,a=R()/n,f=Math.sign(c-a);if(f>0){let d=(w()+y()/2-r)/n,g=w()+y()*d;i=B(g)}else{let u=r+n/2,d=S(u),g=r+n*d;i=B(g)}e!=oe()&&q.push(e);let s=()=>{clearInterval(o);let u=setInterval(()=>{if(e.start<w()){Z(10);return}if(e.end>E()){Z(-10);return}clearInterval(u)},1)},o=setInterval(()=>{W(f,i),f<0&&c>a&&s(),f>0&&c<a&&s()},1)},de=e=>{window.addEventListener("resize",()=>{k()},{passive:!0}),e.addEventListener("wheel",l=>{if(l.defaultPrevented)return;var s=Math.sign(l.deltaY);let g=(((l.target.attributes.starttime?S(l.target.attributes.starttime):0)*e.getBoundingClientRect().width+l.offsetX)/se()-I)/c;W(s,g)},{passive:!0});let i,r,t=!1,n=!0;e.addEventListener("mousedown",l=>{t=!0,i=l.pageX,r=l.pageY},{passive:!0}),e.addEventListener("mousemove",l=>{if(!t||!n)return;n=!1;let s=l.pageX-i;s&&Z(s),i=l.pageX,r=l.pageY,setTimeout(()=>n=!0,10)},{passive:!0}),e.addEventListener("mouseup",()=>{t=!1},{passive:!0});let a=(l,s)=>{let o=document.createDocumentFragment(),u=document.createElement("div");u.className="detailsScrollableContainer",u.style.overflow="auto",u.style.height="100%",u.style.position="absolute";let d=document.createElement("div");if(d.style.padding="10px",u.appendChild(d),o.appendChild(u),console.log(l),l.wikipedia){fetch(l.wikipedia).then(T=>T.json()).then(T=>{let P=document.createElement("H1");if(P.innerHTML=T.query.pages[0].title,d.appendChild(P),T.query.pages[0].thumbnail){let $=document.createElement("p"),F=document.createElement("img");F.src=T.query.pages[0].thumbnail.source,F.style.width="100%",$.appendChild(F),d.appendChild($)}else T.query.pages[0].images&&T.query.pages[0].images.length;let X=document.createElement("p");X.innerHTML=T.query.pages[0].extract,d.appendChild(X),s(o)});return}let g=document.createElement("H3");g.innerHTML="No detail information found...",o.appendChild(g),s(o)},f=l=>{let s=document.createDocumentFragment(),o=document.createElement("div");o.style.overflow="auto",[...q].reverse().forEach(u=>{let d=document.createElement("a");d.innerHTML=u.title,d.href="#",d.style.cursor="pointer",d.addEventListener("click",g=>{g.preventDefault(),d.dispatchEvent(new CustomEvent("event-click",{detail:u,bubbles:!0,cancelable:!0}))}),o.appendChild(d),o.appendChild(document.createElement("br"))}),s.appendChild(o),l(s)}},_=e=>{if(!e||e.start>=E()||e.end<=w())return;let i=document.createDocumentFragment(),r=()=>{i.append(...e.children.reduce((a,f)=>{let l=_(j(A({},f),{level:e.level+(f.level-1)}));return l&&a.push(l),a},new Array))},t=a=>{let f=e.level*1.5,l=a?0:S(e.start),s=a?100:e.duration/y()*100,o=document.createElement("div"),u=e.color.map(d=>d-Math.pow(10,1));o.style.bottom=`${f*h.eventHeight}px`,o.style.minHeight=`${h.eventHeight}px`,o.style.borderRadius="5px",o.style.boxSizing="border-box",o.style.cursor="pointer",o.style.border=`1px solid rgba(${u.join(",")})`,o.style.backgroundColor=`rgb(${e.color.join(",")})`,o.style.zIndex=e.depth.toString(),o.addEventListener("click",d=>{o.dispatchEvent(new CustomEvent("event-click",{detail:e,bubbles:!0,cancelable:!0}))}),o.style.left=l*100+"%",o.style.width=s+"%",o.style.position="absolute",o.style.minWidth="5px",o.title=e.title,o.className="timelineEventGenerated",o.attributes.starttime=e.start,o.attributes.expanded=s>h.expandRatio,i.appendChild(o)},n=a=>{let f=a?0:S(e.start),l=a?100:e.duration/y()*100,s=document.createElement("div");s.style.left=f*100+"%",s.style.width=l+"%",s.style.position="absolute",s.style.minWidth="5px",s.style.overflow="hidden",s.style.bottom="0px",s.style.minHeight="100%",s.style.backgroundColor=`rgb(${e.color.join(",")})`,s.title=e.title,s.className="timelineEventGenerated",i.appendChild(s);let o=document.createElement("div");o.title=e.title,o.innerText=e.title,o.className="timelineEventGeneratedTitle",o.style.whiteSpace="nowrap",o.style.pointerEvents="none",o.style.userSelect="none",s.appendChild(o)};switch(e.type){case"container":r();break;case"timeline":{t(O(e));break}case"background":{n(O(e));break}}return i},ue=()=>{m.style.position="relative",m.style.overflow="hidden",m.style.minHeight="3rem";let e=m.querySelector(".timelineHeaderContainer");x=e||document.createElement("div"),e||m.appendChild(x),x.className="timelineHeaderContainer",x.style.width="100%",x.style.height="20px",x.style.backgroundColor="white";let i=m.querySelector(".timelineLabelContainer");switch(p=i||document.createElement("div"),i||m.appendChild(p),p.className="timelineLabelContainer",p.style.width="100%",p.style.height="50px",p.style.textAlign="center",p.style.position="absolute",p.style.pointerEvents="none",p.style.userSelect="none",h.position){case"top":p.style.top="20px";break;default:p.style.bottom="0"}let r=m.querySelector(".timelineDividerContainer");C=r||document.createElement("div"),r||m.appendChild(C),C.className="timelineDividerContainer",C.style.width="100%",C.style.height="calc(100% - 20px)",C.style.position="absolute",C.style.zIndex="-2",C.style.bottom="0";let t=m.querySelector(".timelineEventsContainer");L=t||document.createElement("div"),t||m.appendChild(L),L.className="timelineEventsContainer",L.style.position="absolute",L.style.bottom="50px",L.style.height="calc(100% - 70px)",L.style.width="100%"},me=e=>{let i=new Date(e*6e4);return y()<5760?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(i):y()<60480?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(i):y()<788923.1502?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short"}).format(i):i.getFullYear().toString()},k=()=>{if(!m)return;let e=Math.floor(c),i=Math.pow(2,Math.floor(Math.log2(e))),r=1/(h.labelCount+1),t=w()-M,a=R()*r/i,l=Math.floor(t/a)*a,s=document.createDocumentFragment(),o=document.createDocumentFragment();for(let d=0;d<h.labelCount+2;d++){let g=(d+1)*a+M+l-a,T=g+a/2,X=S(g)*100,F=S(T)*100,D=document.createElement("div");D.className="timelineLabel",D.style.left=X+"%",D.style.top="50%",D.style.transform="translate(calc(-50%), calc(-50%))",D.style.textAlign="center",D.style.position="absolute",D.style.zIndex="-1",D.style.width=r*100+"%",D.innerHTML=me(g),s.appendChild(D);let H=document.createElement("div");H.className="timelineDivider",H.style.left=F+"%",H.style.textAlign="center",H.style.position="absolute",H.style.height="100%",H.style.zIndex="-10",H.innerHTML="",o.appendChild(H)}p.innerHTML="",p.appendChild(s),C.innerHTML="",C.appendChild(o);let u=_(Y);L.innerHTML="",u&&L.appendChild(u),m.dispatchEvent(new CustomEvent("update",{detail:ge(),bubbles:!0,cancelable:!0,composed:!1}))},z=e=>{if(e===void 0)return;let i=t=>{let n=new Date;if(n.setDate(t[2]?t[2]:1),n.setMonth(t[1]?t[1]-1:0),n.setHours(t[3]?t[3]:0),n.setMinutes(t[4]?t[4]:0),n.setSeconds(0),!t[0])return n.getTime()/6e4;if(t[0]&&t[0]>-27e4&&t[0]<27e4)return n.setFullYear(t[0]),n.getTime()/6e4;let a=525948.766*t[0];return n.setFullYear(0),a+n.getTime()/6e4},r=t=>{switch(t){case"now":return new Date;default:let n=Number(t.replace(/y$/,""));return isNaN(n)?new Date(t):new Date(Date.now()+31556926*1e3*n)}};if(Array.isArray(e)){let t=e;if(t.length===0)throw new Error("argument Array cannot be empty");if(!t.every(a=>typeof a=="number"))throw new Error("input Array must contain only numbers");return i(t)}if(typeof e=="object"&&e.constructor.name==="Date")return e.getTime()/6e4;if(typeof e=="string")return r(e).getTime()/6e4;if(typeof e=="number")return new Date(e).getTime()/6e4},he=e=>e.every(i=>typeof i=="number"),J=e=>e.start?e.children.length?Math.min(e.start,e.children[0].start):e.start:e.children.length?e.children[0].start:void 0,K=e=>e.end?e.end:e.duration&&!isNaN(Number(e.duration))?e.start+Number(e.duration):e.children.length&&e.children[e.children.length-1].end||e.start+1,be=(e,i)=>{let r=0;for(let t in i.levelMatrix)if(r=Number(t),e.start>i.levelMatrix[t].time){for(let n=0;n<e.height;n++)i.levelMatrix[(r+n).toString()]={height:e.height,time:e.end};return r}r++;for(let t=0;t<e.height;t++)i.levelMatrix[(r+t).toString()]={height:e.height,time:e.end};return r},Q=(e,...i)=>{let r=(n,a)=>n.duration/a.duration*n.children.length||1,t=i.map(n=>U(n,e)).filter(n=>!!n);t&&t.length&&e&&(e.children.push(...t),e.children.sort((n,a)=>n.start-a.start),e.start=J(e),e.end=K(e),e.duration=e.end-e.start,e.levelMatrix={1:{height:0,time:Number.MIN_SAFE_INTEGER}},e.children.forEach((n,a)=>{n.score=["container","timeline"].includes(n.type)?r(n,e):0,n.level=["container","timeline"].includes(n.type)?be(n,e):0})),e.height=e.children.length?Math.max.apply(1,e.children.map(n=>n.level)):1},U=(e,i)=>{if(!e){console.warn("Event object is empty");return}let r=j(A({type:"timeline",duration:0,level:1,step:0,score:0,height:1,children:[],depth:i?i.depth+1:0},e),{color:e.color?he(e.color)?e.color:[140,140,140,e.type==="background"?.1:1]:[140,140,140,e.type==="background"?.1:1],start:z(e.start),end:z(e.end)});if(e.events&&e.events.length&&Q(r,...e.events),r.start=J(r),!r.start){console.warn("Missing start property on event - skipping",e);return}return r.end=K(r),r.duration=r.end-r.start,r},fe=e=>{let i=[],r=e.querySelectorAll(".timelineEvent");return r&&r.forEach(t=>{try{i.push(j(A({},t.attributes),{events:fe(t)}))}catch(n){console.error(n,"timelineEvent")}}),i},ge=()=>({options:h,viewStartDate:w(),viewEndDate:E(),viewDuration:y(),ratio:c,pivot:I});return ie(v,b),{focus:ce,load:re,current:Y,element:m}};window.Timeline=ne;})();
