var ve=Object.defineProperty,ge=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var Q=(g,f,l)=>f in g?ve(g,f,{enumerable:!0,configurable:!0,writable:!0,value:l}):g[f]=l,$=(g,f)=>{for(var l in f||(f={}))Me.call(f,l)&&Q(g,l,f[l]);if(J)for(var l of J(f))Te.call(f,l)&&Q(g,l,f[l]);return g},P=(g,f)=>ge(g,he(f));var ee=(g,f,l)=>new Promise((h,M)=>{var S=u=>{try{a(l.next(u))}catch(v){M(v)}},c=u=>{try{a(l.throw(u))}catch(v){M(v)}},a=u=>u.done?h(u.value):Promise.resolve(u.value).then(S,c);a((l=l.apply(g,f)).next())});var De=(g,f)=>{let l,h,M,S,c,a,u,v,w,x,_=525948.766,te=_/12*18,ne=10080*6,re=1440*4,ie=e=>ee(void 0,null,function*(){if(!e)throw new Error("Argument is empty. Please provide a loader function as first arg");Y(yield e())}),Y=e=>{if(!e)throw new Error("Event argument is empty. Please provide Timeline event as first arg");W(x,e),A()},V=e=>e.start<p()&&e.end>k(),se=(e,n)=>{if(!e)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof e=="string"){let s=document.querySelector(e);if(!s)throw new Error(`Selector could not be found [${c}]`);c=s}e instanceof HTMLElement&&(c=e),a=$({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-1B",timelineEnd:"1M",start:"-100y",end:"now",minZoom:1,maxZoom:1e11,position:"bottom",eventHeight:5,autoFocus:!1,defaultColor:[140,140,140],classNames:{timeline:"tl",timelineEvent:"tl__event",timelineEventTitle:"tl__event__title",timelineLabels:"tl__labels",timelineDividers:"tl__dividers",timelineEvents:"tl__events",timelineLabel:"tl__label",timelineDivider:"tl__divider"}},n),x=G({title:"View",type:"container",start:a.start,end:a.end}),M=O(a.timelineStart),S=O(a.timelineEnd);let r=x.startMinutes,t=x.endMinutes;r<M&&(M=r),t>S&&(S=t);let i=t-r;l=R()/i,h=(M-r)/i,de(),ce(c),A()},R=()=>S-M,oe=()=>c.offsetWidth||0,p=()=>M-T()*h,k=()=>p()+T(),T=()=>R()/l,ae=()=>a.zoomSpeed*l,H=e=>(e-p())/T(),z=e=>(e-M)/R(),le=(e,n)=>{let r=l-n;return e===1&&r<=a.minZoom||e===-1&&r>=a.maxZoom?!1:(l=r,!0)},B=e=>{let n=h+e;n>=0&&(n=0),n+l<=1&&(n=1-l),h=n},U=(e,n)=>{let r=e*ae(),t=n*r;le(e,r)&&B(t),A()},X=e=>{B(e*a.dragSpeed),A()},Z=(e,n)=>{if(!e)return;let r=e.durationMinutes*.05,t=e.startMinutes-r,s=e.endMinutes+r-t,m=R()/s,d=Math.sign(l-m),y=d>0,o=0;if(y){let D=(p()+T()/2-t)/s,L=p()+T()*D;o=z(L)}else{let E=t+s/2,D=H(E),L=t+s*D;o=z(L)}let b=()=>{clearInterval(I);let E=h-(t-p())/T(),D=Math.sign(E-h),L=()=>{clearInterval(F),c.dispatchEvent(new CustomEvent("focus.tl.event",{detail:e,bubbles:!1,cancelable:!0})),n&&n()},F=setInterval(()=>{X(D*10),D<0&&h<E&&L(),D>0&&h>E&&L()},1)},I=setInterval(()=>{U(d,o),d<0&&l>m&&b(),d>0&&l<m&&b()},1)},ce=e=>{window.addEventListener("resize",()=>{A()},{passive:!0}),e.addEventListener("wheel",s=>{if(s.defaultPrevented)return;var m=Math.sign(s.deltaY);let b=(((s.target.attributes.starttime?H(s.target.attributes.starttime):0)*e.getBoundingClientRect().width+s.offsetX)/oe()-h)/l;U(m,b)},{passive:!0});let n,r,t=!1,i=!0;e.addEventListener("mousedown",s=>{t=!0,n=s.pageX,r=s.pageY},{passive:!0}),e.addEventListener("mousemove",s=>{if(!t||!i)return;i=!1;let m=s.pageX-n;m&&X(m),n=s.pageX,r=s.pageY,setTimeout(()=>i=!0,10)},{passive:!0}),e.addEventListener("mouseup",()=>{t=!1},{passive:!0})},j=e=>{if(!e||e.startMinutes>=k()||e.endMinutes<=p())return;let n=document.createDocumentFragment(),r=()=>{n.append(...e.children.reduce((s,m)=>{let d=j(P($({},m),{level:e.level+(m.level-1)}));return d&&s.push(d),s},new Array))},t=s=>{let m=e.level*1.5,d=s?0:H(e.startMinutes),y=s?100:e.durationMinutes/T()*100,o=document.createElement("div");o.style.bottom=`${m*a.eventHeight}px`,o.style.minHeight=`${a.eventHeight}px`,o.style.borderRadius="5px",o.style.boxSizing="border-box",o.style.cursor="pointer",o.style.backgroundColor=`rgb(${e.color.join(",")})`,o.style.zIndex=e.depth.toString(),o.addEventListener("click",b=>{c.dispatchEvent(new CustomEvent("click.tl.event",{detail:e,bubbles:!1,cancelable:!0})),a.autoFocus&&Z(e)}),o.addEventListener("mouseenter",b=>{c.dispatchEvent(new CustomEvent("mouseenter.tl.event",{detail:e,bubbles:!1,cancelable:!0}))}),o.addEventListener("mouseleave",b=>{c.dispatchEvent(new CustomEvent("mouseleave.tl.event",{detail:e,bubbles:!1,cancelable:!0}))}),o.addEventListener("dblclick",b=>{c.dispatchEvent(new CustomEvent("dblclick.tl.event",{detail:e,bubbles:!1,cancelable:!0}))}),o.style.left=d*100+"%",o.style.width=y+"%",o.style.position="absolute",o.style.minWidth="5px",o.title=e.title,o.classList.add(a.classNames.timelineEvent),o.attributes.starttime=s?p():e.startMinutes,n.appendChild(o)},i=s=>{let m=s?0:H(e.startMinutes),d=s?100:e.durationMinutes/T()*100,y=e.color.length===3?[...e.color,.1]:e.color,o=document.createElement("div");o.style.left=m*100+"%",o.style.width=d+"%",o.style.position="absolute",o.style.minWidth="5px",o.style.overflow="hidden",o.style.bottom="0px",o.style.minHeight="100%",o.style.backgroundColor=`rgb(${y.join(",")})`,o.classList.add(a.classNames.timelineEvent),o.attributes.starttime=s?p():e.startMinutes,n.appendChild(o);let b=document.createElement("div");b.innerText=e.title,b.style.whiteSpace="nowrap",b.style.pointerEvents="none",b.style.userSelect="none",b.classList.add(a.classNames.timelineEventTitle),o.appendChild(b)};switch(e.type){case"container":r();break;case"timeline":{t(V(e));break}case"background":{i(V(e));break}}return n},de=()=>{c.style.position="relative",c.style.overflow="hidden",c.style.minHeight="3rem";let e=c.querySelector(`.${a.classNames.timelineLabels}`);switch(u=e||document.createElement("div"),e||c.appendChild(u),u.classList.add(a.classNames.timelineLabels),u.style.width="100%",u.style.height="50px",u.style.textAlign="center",u.style.position="absolute",u.style.pointerEvents="none",u.style.userSelect="none",a.position){case"top":u.style.top="0";break;default:u.style.bottom="0"}let n=c.querySelector(`.${a.classNames.timelineDividers}`);v=n||document.createElement("div"),n||c.appendChild(v),v.classList.add(a.classNames.timelineDividers),v.style.width="100%",v.style.height="100%",v.style.position="absolute",v.style.zIndex="-2",v.style.bottom="0";let r=c.querySelector(`.${a.classNames.timelineEvents}`);w=r||document.createElement("div"),r||c.appendChild(w),w.classList.add(a.classNames.timelineEvents),w.style.position="absolute",w.style.bottom="50px",w.style.height="calc(100% - 50px)",w.style.width="100%"},ue=e=>{let n=Math.floor(e/_),r=n+1970,i=r>-1e4&&r<1e4?r.toString():r.toLocaleString("en-US",{notation:"compact",minimumFractionDigits:1,maximumFractionDigits:1}),s=Math.abs(e-n*_),d=e>27e4*_*-1&&e<27e4*_?new Date(e*6e4):new Date(s*6e4);return T()<re?[Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}).format(d),i,Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric"}).format(d)].join(" "):T()<ne?[Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}).format(d),i].join(" "):T()<te?[Intl.DateTimeFormat(void 0,{month:"short"}).format(d),i].join(" "):i},A=()=>{if(!c)return;let e=Math.floor(l),n=Math.pow(2,Math.floor(Math.log2(e))),r=1/(a.labelCount+1),t=p()-M,s=R()*r/n,d=Math.floor(t/s)*s,y=document.createDocumentFragment(),o=document.createDocumentFragment();for(let I=0;I<a.labelCount+2;I++){let E=(I+1)*s+M+d-s,D=E+s/2,F=H(E)*100,fe=H(D)*100,N=document.createElement("div");N.classList.add(a.classNames.timelineLabel),N.style.left=F+"%",N.style.top="50%",N.style.transform="translate(calc(-50%), calc(-50%))",N.style.textAlign="center",N.style.position="absolute",N.style.zIndex="-1",N.style.width=r*100+"%",N.innerHTML=ue(E),y.appendChild(N);let C=document.createElement("div");C.classList.add(a.classNames.timelineDivider),C.style.left=fe+"%",C.style.textAlign="center",C.style.position="absolute",C.style.height="100%",C.style.zIndex="-10",C.innerHTML="",o.appendChild(C)}u.innerHTML="",u.appendChild(y),v.innerHTML="",v.appendChild(o);let b=j(x);w.innerHTML="",b&&w.appendChild(b),c.dispatchEvent(new CustomEvent("update.tl.container",{detail:{options:a,viewStartDate:p(),viewEndDate:k(),viewDuration:T(),ratio:l,pivot:h},bubbles:!1,cancelable:!0,composed:!1}))},O=e=>{if(e===void 0)return new Date().getTime()/6e4;let n=t=>{let i=new Date;return i.setDate(t[2]?t[2]:1),i.setMonth(t[1]?t[1]-1:0),i.setHours(t[3]?t[3]:0),i.setMinutes(t[4]?t[4]:0),i.setSeconds(0),t[0]?t[0]&&t[0]>-27e4&&t[0]<27e4?(i.setFullYear(t[0]),i.getTime()/6e4):525948.766*t[0]+i.getTime()/6e4:i.getTime()/6e4},r=t=>{switch(t){case"now":return n([]);default:let i=t.match(/y$/)?Number(t.replace(/y$/,"")):NaN;if(!isNaN(i))return n([i+1970]);let s=t.match(/K$/)?Number(t.replace(/K$/,"")):NaN;if(!isNaN(s))return n([s*1e3]);let m=t.match(/M$/)?Number(t.replace(/M$/,"")):NaN;if(!isNaN(m))return n([m*1e6]);let d=t.match(/B$/)?Number(t.replace(/B$/,"")):NaN;if(!isNaN(d))return n([d*1e9]);let y=t.match(/bc$/)?Number(t.replace(/bc$/,"")):NaN;if(!isNaN(y))return n([-y]);let o=t.match(/ad$/)?Number(t.replace(/ad$/,"")):NaN;if(!isNaN(o))return n([o]);let b=Number(t);if(!isNaN(b))return new Date().getTime()/6e4+b*6e4;let I=Date.parse(t);return isNaN(I)?new Date().getTime()/6e4:I/6e4}};if(Array.isArray(e)){let t=e;if(t.length===0)throw new Error("argument Array cannot be empty");if(!t.every(s=>typeof s=="number"))throw new Error("input Array must contain only numbers");return n(t)}if(typeof e=="object"&&e.constructor.name==="Date")return e.getTime()/6e4;if(typeof e=="string")return r(e);if(typeof e=="number")return new Date(e).getTime()/6e4},q=e=>e.startMinutes?e.children.length?Math.min(e.startMinutes,e.children[0].startMinutes):e.startMinutes:e.children.length?e.children[0].startMinutes:void 0,K=(e,n)=>e.endMinutes?e.endMinutes:n&&!isNaN(Number(n))?e.startMinutes+Number(n):e.children.length&&e.children[e.children.length-1].endMinutes||e.startMinutes+1,me=(e,n)=>{let r=0;for(let t in n.levelMatrix)if(r=Number(t),e.startMinutes>n.levelMatrix[t].time){for(let i=0;i<e.height;i++)n.levelMatrix[(r+i).toString()]={height:e.height,time:e.endMinutes};return r}r++;for(let t=0;t<e.height;t++)n.levelMatrix[(r+t).toString()]={height:e.height,time:e.endMinutes};return r},W=(e,...n)=>{let r=(i,s)=>i.durationMinutes/s.durationMinutes*i.children.length||1,t=n.map(i=>G(i,e)).filter(i=>!!i);t&&t.length&&e&&(e.children.push(...t),e.children.sort((i,s)=>i.startMinutes-s.startMinutes),e.startMinutes=q(e),e.endMinutes=K(e),e.durationMinutes=e.endMinutes-e.startMinutes,e.levelMatrix={1:{height:0,time:Number.MIN_SAFE_INTEGER}},e.children.forEach((i,s)=>{i.score=["container","timeline"].includes(i.type)?r(i,e):0,i.level=["container","timeline"].includes(i.type)?me(i,e):0})),e.height=e.children.length?Math.max.apply(1,e.children.map(i=>i.level)):1},G=(e,n)=>{if(!e){console.warn("Event object is empty");return}let r=P($({durationMinutes:0,type:"timeline",level:1,step:0,score:0,height:1,children:[],depth:n?n.depth+1:0},e),{color:e.color||a.defaultColor,startMinutes:O(e.start),endMinutes:O(e.end)});if(e.events&&e.events.length&&W(r,...e.events),r.startMinutes=q(r),!r.startMinutes){console.warn("Missing start property on event - skipping",e);return}return r.endMinutes=K(r,e.duration),r.durationMinutes=r.endMinutes-r.startMinutes,r},be=e=>{let n=[],r=e.querySelectorAll(".timelineEvent");return r&&r.forEach(t=>{try{n.push(P($({},t.attributes),{events:be(t)}))}catch(i){console.error(i,"timelineEvent")}}),n};return se(g,f),{focus:Z,load:ie,add:Y}};export{De as Timeline};
