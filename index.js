var Me=Object.defineProperty,ye=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var se=(D,v,a)=>v in D?Me(D,v,{enumerable:!0,configurable:!0,writable:!0,value:a}):D[v]=a,O=(D,v)=>{for(var a in v||(v={}))Ie.call(v,a)&&se(D,a,v[a]);if(ie)for(var a of ie(v))we.call(v,a)&&se(D,a,v[a]);return D},U=(D,v)=>ye(D,pe(v));var re=(D,v,a)=>new Promise((h,g)=>{var C=u=>{try{l(a.next(u))}catch(b){g(b)}},c=u=>{try{l(a.throw(u))}catch(b){g(b)}},l=u=>u.done?h(u.value):Promise.resolve(u.value).then(C,c);l((a=a.apply(D,v)).next())});var xe=(D,v)=>{let a,h,g,C,c,l,u,b,S,_,N,z=525948.766,le=z/12*18,ae=10080*6,oe=1440*4,V=e=>"timelineEventDetails"in e,me=e=>re(void 0,null,function*(){if(!e)throw new Error("Argument is empty. Please provide a loader function as first arg");Z(yield e())}),Z=(...e)=>{if(!e)throw new Error("Event argument is empty. Please provide Timeline event(s) as input");te(_,...e),k()},ce=e=>e.start<w()&&e.end>P(),ue=(e,n)=>{if(!e)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof e=="string"){let s=document.querySelector(e);if(!s)throw new Error(`Selector could not be found [${c}]`);c=s}e instanceof HTMLElement&&(c=e),l=O({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-1B",timelineEnd:"1M",start:"-100y",end:"now",minZoom:1,maxZoom:1e11,position:"bottom",eventHeight:5,autoZoom:!1,defaultColor:[140,140,140],classNames:{timeline:"tl",timelineEvent:"tl__event",timelineEventTitle:"tl__event__title",timelineLabels:"tl__labels",timelineDividers:"tl__dividers",timelineEvents:"tl__events",timelineLabel:"tl__label",timelineDivider:"tl__divider"}},n),_=ne({title:"View",type:"container",start:l.start,end:l.end}),g=A(l.timelineStart),C=A(l.timelineEnd);let i=_.timelineEventDetails.startMinutes,t=_.timelineEventDetails.endMinutes;i<g&&(g=i),t>C&&(C=t);let r=t-i;a=$()/r,h=(g-i)/r,De(),fe(c),K(_,!1)},$=()=>C-g,de=()=>c.offsetWidth||0,w=()=>g-y()*h,P=()=>w()+y(),y=()=>$()/a,ve=()=>l.zoomSpeed*a,W=e=>(e-w())/y(),j=e=>(e-g)/$(),Ee=(e,n)=>{let i=a-n;return e===1&&i<=l.minZoom||e===-1&&i>=l.maxZoom?!1:(a=i,!0)},X=e=>{let n=h+e;n>=0&&(n=0),n+a<=1&&(n=1-a),h=n},B=(e,n)=>{let i=e*ve(),t=n*i;Ee(e,i)&&X(t),k()},q=e=>{X(e*l.dragSpeed),k()},K=(e,n=!0,i)=>{if(!e)throw"first argument 'timelineEvent' of method 'zoom' must be an object";if(!V(e))throw"first argument 'timelineEvent' of method 'zoom' must be an object of type ITimelineEventWithDetails";N=e,Y(N.timelineEventDetails.startMinutes,N.timelineEventDetails.endMinutes,n,()=>{c.dispatchEvent(new CustomEvent("focus.tl.event",{detail:N,bubbles:!1,cancelable:!0})),i&&i(N)})},be=()=>{N=_,Y(l.start?A(l.start):N.timelineEventDetails.startMinutes,l.end?A(l.end):N.timelineEventDetails.endMinutes)},G=(e,n=!0,i)=>{if(!e)throw"first argument 'timelineEvent' of method 'zoom' must be an object";if(!V(e))throw"first argument 'timelineEvent' of method 'zoom' must be an object of type ITimelineEventWithDetails";Y(e.timelineEventDetails.startMinutes,e.timelineEventDetails.endMinutes,n,()=>{c.dispatchEvent(new CustomEvent("zoom.tl.event",{detail:e,bubbles:!1,cancelable:!0})),i&&i(e)})},Y=(e,n,i=!0,t)=>{if(!e)throw"first argument 'startMinutes' of method 'zoomto' must be a number";if(!n)throw"second argument 'endMinutes' of method 'zoomto' must be a number";let r=(n-e)*.05,s=e-r,d=n+r-s,f=$()/d,E=Math.sign(a-f),T=E>0,m=0;if(T){let L=(w()+y()/2-s)/d,H=w()+y()*L;m=j(H)}else{let o=s+d/2,L=W(o),H=s+d*L;m=j(H)}i?(()=>{let o=()=>{clearInterval(L);let H=h-(s-w())/y(),R=Math.sign(H-h),F=()=>{clearInterval(I),t&&t()},I=setInterval(()=>{q(R*10),R<0&&h<H&&F(),R>0&&h>H&&F()},1)},L=setInterval(()=>{B(E,m),E<0&&a>f&&o(),E>0&&a<f&&o()},1)})():(a=f,h=(g-s)/d,k())},fe=e=>{window.addEventListener("resize",()=>{k()},{passive:!0}),e.addEventListener("wheel",s=>{if(s.defaultPrevented)return;var p=Math.sign(s.deltaY);let T=(((s.target.attributes.starttime?W(s.target.attributes.starttime):0)*e.getBoundingClientRect().width+s.offsetX)/de()-h)/a;B(p,T)},{passive:!0});let n,i,t=!1,r=!0;e.addEventListener("mousedown",s=>{t=!0,n=s.pageX,i=s.pageY},{passive:!0}),e.addEventListener("mousemove",s=>{if(!t||!r)return;r=!1;let p=s.pageX-n;p&&q(p),n=s.pageX,i=s.pageY,setTimeout(()=>r=!0,10)},{passive:!0}),e.addEventListener("mouseup",()=>{t=!1},{passive:!0})},J=e=>{let n=document.createDocumentFragment();for(let[i,t]of Object.entries(e.timelineEventDetails.children)){if(!t||!t.timelineEventDetails||t.timelineEventDetails.startMinutes>=P()||t.timelineEventDetails.endMinutes<=w())continue;let r=!1;if(r)continue;let s=ce(t),p=()=>{let f=t.timelineEventDetails.parentId?e.timelineEventDetails.level:0,E=t.timelineEventDetails.level*1.5,T=s?0:W(t.timelineEventDetails.startMinutes),m=s?100:t.timelineEventDetails.durationMinutes/y()*100,M=r?[t.timelineEventDetails.color[0],t.timelineEventDetails.color[1],t.timelineEventDetails.color[2],.1]:t.timelineEventDetails.color,o=document.createElement("div");return o.style.bottom=`${E*l.eventHeight}px`,o.style.minHeight=`${l.eventHeight}px`,o.style.borderRadius="5px",o.style.boxSizing="border-box",o.style.cursor="pointer",o.style.backgroundColor=`rgb(${M.join(",")})`,o.style.zIndex=t.timelineEventDetails.depth.toString(),o.style.left=T*100+"%",o.style.width=m+"%",o.style.position="absolute",o.style.minWidth="5px",o.title=t.title,o.classList.add(l.classNames.timelineEvent),o.setAttribute("level",t.timelineEventDetails.level.toString()),o.setAttribute("depth",t.timelineEventDetails.depth.toString()),o.setAttribute("height",t.timelineEventDetails.height.toString()),o.attributes.starttime=s?w():t.timelineEventDetails.startMinutes,o.addEventListener("click",L=>{c.dispatchEvent(new CustomEvent("click.tl.event",{detail:t,bubbles:!1,cancelable:!0})),l.autoZoom&&G(t)}),o.addEventListener("mouseenter",L=>{c.dispatchEvent(new CustomEvent("mouseenter.tl.event",{detail:t,bubbles:!1,cancelable:!0}))}),o.addEventListener("mouseleave",L=>{c.dispatchEvent(new CustomEvent("mouseleave.tl.event",{detail:t,bubbles:!1,cancelable:!0}))}),o.addEventListener("dblclick",L=>{c.dispatchEvent(new CustomEvent("dblclick.tl.event",{detail:t,bubbles:!1,cancelable:!0}))}),o},d=()=>{let f=s?0:W(t.timelineEventDetails.startMinutes),E=s?100:t.timelineEventDetails.durationMinutes/y()*100,T=t.timelineEventDetails.color.length===3?[...t.timelineEventDetails.color,.1]:t.timelineEventDetails.color,m=document.createElement("div");m.style.left=f*100+"%",m.style.width=E+"%",m.style.position="absolute",m.style.minWidth="5px",m.style.overflow="hidden",m.style.bottom="0px",m.style.minHeight="100%",m.style.backgroundColor=`rgb(${T.join(",")})`,m.classList.add(l.classNames.timelineEvent),m.attributes.starttime=s?w():t.timelineEventDetails.startMinutes;let M=document.createElement("div");return M.innerText=t.title,M.style.whiteSpace="nowrap",M.style.pointerEvents="none",M.style.userSelect="none",M.classList.add(l.classNames.timelineEventTitle),m.appendChild(M),m};switch(t.timelineEventDetails.type){case"container":{n.append(J(t));break}case"timeline":{n.append(p());break}case"background":{n.append(d());break}}}return n},De=()=>{c.style.position="relative",c.style.overflow="hidden",c.style.minHeight="3rem";let e=c.querySelector(`.${l.classNames.timelineLabels}`);switch(u=e||document.createElement("div"),e||c.appendChild(u),u.classList.add(l.classNames.timelineLabels),u.style.width="100%",u.style.height="50px",u.style.textAlign="center",u.style.position="absolute",u.style.pointerEvents="none",u.style.userSelect="none",l.position){case"top":u.style.top="0";break;default:u.style.bottom="0"}let n=c.querySelector(`.${l.classNames.timelineDividers}`);b=n||document.createElement("div"),n||c.appendChild(b),b.classList.add(l.classNames.timelineDividers),b.style.width="100%",b.style.height="100%",b.style.position="absolute",b.style.zIndex="-2",b.style.bottom="0";let i=c.querySelector(`.${l.classNames.timelineEvents}`);S=i||document.createElement("div"),i||c.appendChild(S),S.classList.add(l.classNames.timelineEvents),S.style.position="absolute",S.style.bottom="50px",S.style.height="calc(100% - 50px)",S.style.width="100%"},he=e=>{let n=Math.floor(e/z),i=n+1970,r=i>-1e4&&i<1e4?i.toString():i.toLocaleString("en-US",{notation:"compact",minimumFractionDigits:1,maximumFractionDigits:1}),s=Math.abs(e-n*z),d=e>27e4*z*-1&&e<27e4*z?new Date(e*6e4):new Date(s*6e4);return y()<oe?[Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}).format(d),r,Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric"}).format(d)].join(" "):y()<ae?[Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}).format(d),r].join(" "):y()<le?[Intl.DateTimeFormat(void 0,{month:"short"}).format(d),r].join(" "):r},k=()=>{if(!c||!N)return;let e=Math.floor(a),n=Math.pow(2,Math.floor(Math.log2(e))),i=1/(l.labelCount+1),t=w()-g,s=$()*i/n,d=Math.floor(t/s)*s,f=document.createDocumentFragment(),E=document.createDocumentFragment();for(let m=0;m<l.labelCount+2;m++){let M=(m+1)*s+g+d-s,o=M+s/2,H=W(M)*100,F=W(o)*100,I=document.createElement("div");I.classList.add(l.classNames.timelineLabel),I.style.left=H+"%",I.style.top="50%",I.style.transform="translate(calc(-50%), calc(-50%))",I.style.textAlign="center",I.style.position="absolute",I.style.zIndex="-1",I.style.width=i*100+"%",I.innerHTML=he(M),f.appendChild(I);let x=document.createElement("div");x.classList.add(l.classNames.timelineDivider),x.style.left=F+"%",x.style.textAlign="center",x.style.position="absolute",x.style.height="100%",x.style.zIndex="-10",x.innerHTML="",E.appendChild(x)}u.innerHTML="",u.appendChild(f),b.innerHTML="",b.appendChild(E);let T=J(N);S.innerHTML="",T&&S.appendChild(T),c.dispatchEvent(new CustomEvent("update.tl.container",{detail:{options:l,viewStartDate:w(),viewEndDate:P(),viewDuration:y(),ratio:a,pivot:h},bubbles:!1,cancelable:!0,composed:!1}))},A=e=>{if(e===void 0)return;let n=t=>{let r=new Date;return r.setDate(t[2]?t[2]:1),r.setMonth(t[1]?t[1]-1:0),r.setHours(t[3]?t[3]:0),r.setMinutes(t[4]?t[4]:0),r.setSeconds(0),t[0]?t[0]&&t[0]>-27e4&&t[0]<27e4?(r.setFullYear(t[0]),r.getTime()/6e4):525948.766*t[0]+r.getTime()/6e4:r.getTime()/6e4},i=t=>{switch(t){case"now":return n([]);default:let r=t.match(/y$/)?Number(t.replace(/y$/,"")):NaN;if(!isNaN(r))return n([r+1970]);let s=t.match(/K$/)?Number(t.replace(/K$/,"")):NaN;if(!isNaN(s))return n([s*1e3]);let p=t.match(/M$/)?Number(t.replace(/M$/,"")):NaN;if(!isNaN(p))return n([p*1e6]);let d=t.match(/B$/)?Number(t.replace(/B$/,"")):NaN;if(!isNaN(d))return n([d*1e9]);let f=t.match(/bc$/)?Number(t.replace(/bc$/,"")):NaN;if(!isNaN(f))return n([-f]);let E=t.match(/ad$/)?Number(t.replace(/ad$/,"")):NaN;if(!isNaN(E))return n([E]);let T=Number(t);if(!isNaN(T))return new Date().getTime()/6e4+T*6e4;let m=Date.parse(t);return isNaN(m)?new Date().getTime()/6e4:m/6e4}};if(Array.isArray(e)){let t=e;if(t.length===0)throw new Error("argument Array cannot be empty");if(!t.every(s=>typeof s=="number"))throw new Error("input Array must contain only numbers");return n(t)}if(typeof e=="object"&&e.constructor.name==="Date")return e.getTime()/6e4;if(typeof e=="string")return i(e);if(typeof e=="number")return new Date(e).getTime()/6e4},Q=(e,n)=>e.timelineEventDetails.startMinutes?n&&n.length?Math.min(e.timelineEventDetails.startMinutes,n[0].timelineEventDetails.startMinutes):e.timelineEventDetails.startMinutes:n&&n.length?n[0].timelineEventDetails.startMinutes:void 0,ee=(e,n)=>e.timelineEventDetails.endMinutes?e.timelineEventDetails.endMinutes:e.duration&&!isNaN(Number(e.duration))?e.timelineEventDetails.startMinutes+Number(e.duration):n&&n.length?Math.max.apply(1,n.map(i=>i.timelineEventDetails.endMinutes)):e.timelineEventDetails.startMinutes+1,ge=(e,n)=>{let i=0;for(let t in n.timelineEventDetails.levelMatrix)if(i=Number(t),e.timelineEventDetails.startMinutes>n.timelineEventDetails.levelMatrix[t].time){for(let r=0;r<e.timelineEventDetails.height;r++)n.timelineEventDetails.levelMatrix[(i+r).toString()]={height:e.timelineEventDetails.height,time:e.timelineEventDetails.endMinutes};return i}i++;for(let t=0;t<e.timelineEventDetails.height;t++)n.timelineEventDetails.levelMatrix[(i+t).toString()]={height:e.timelineEventDetails.height,time:e.timelineEventDetails.endMinutes};return i},te=(e,...n)=>{let i=n.map(t=>ne(t,e)).filter(t=>!!t);i&&i.length&&e&&(i.sort((t,r)=>t.timelineEventDetails.startMinutes-r.timelineEventDetails.startMinutes),e.timelineEventDetails.startMinutes=Q(e,i),e.timelineEventDetails.endMinutes=ee(e,i),e.timelineEventDetails.durationMinutes=e.timelineEventDetails.endMinutes-e.timelineEventDetails.startMinutes,i.forEach((t,r)=>{e.timelineEventDetails.children[t.timelineEventDetails.id]=t,t.timelineEventDetails.level=["timeline","container"].includes(t.timelineEventDetails.type)?ge(t,e):0})),e.timelineEventDetails.height=i.length?Math.max(...i.map(t=>t.timelineEventDetails.level)):1},ne=(e,n)=>{if(!e){console.warn("Event object is empty");return}let i=U(O({},e),{timelineEventDetails:{id:crypto.randomUUID(),durationMinutes:0,type:e.type||"timeline",open:e.open||!1,level:1,step:0,score:0,height:1,children:{},depth:n?n.timelineEventDetails.depth+1:0,parentId:n==null?void 0:n.timelineEventDetails.id,color:e.color||l.defaultColor,startMinutes:A(e.start),endMinutes:A(e.end),levelMatrix:{1:{height:0,time:Number.MIN_SAFE_INTEGER}}}});if(e.events&&e.events.length&&te(i,...e.events),i.timelineEventDetails.startMinutes=Q(i),!i.timelineEventDetails.startMinutes){console.warn("Missing start property on event - skipping",e);return}return i.timelineEventDetails.endMinutes=ee(i),i.timelineEventDetails.durationMinutes=i.timelineEventDetails.endMinutes-i.timelineEventDetails.startMinutes,i},Te=e=>{let n=[],i=e.querySelectorAll(".timelineEvent");return i&&i.forEach(t=>{try{n.push(U(O({},t.attributes),{events:Te(t)}))}catch(r){console.error(r,"timelineEvent")}}),n};return ue(D,v),{focus:K,zoom:G,load:me,add:Z,reset:be}};export{xe as Timeline};
