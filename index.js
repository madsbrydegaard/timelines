var ge=Object.defineProperty,ye=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var U=(h,b,a)=>b in h?ge(h,b,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[b]=a,A=(h,b)=>{for(var a in b||(b={}))Te.call(b,a)&&U(h,a,b[a]);if(Q)for(var a of Q(b))ve.call(b,a)&&U(h,a,b[a]);return h},V=(h,b)=>ye(h,pe(b));var W=(h,b,a)=>new Promise((M,y)=>{var x=d=>{try{u(a.next(d))}catch(f){y(f)}},l=d=>{try{u(a.throw(d))}catch(f){y(f)}},u=d=>d.done?M(d.value):Promise.resolve(d.value).then(x,l);u((a=a.apply(h,b)).next())});var He=(h,b)=>{let a,M,y,x,l,u,d,f,C,H,Y=[],z,N,ee=(e,n)=>{l.addEventListener(e,n)},te=e=>W(void 0,null,function*(){if(!e)throw new Error("Argument is empty. Please provide a loader function as first arg");Z(yield e())}),Z=e=>{if(!e)throw new Error("Event argument is empty. Please provide Timeline event as first arg");J(N,e),k()},we=e=>e.start<S()&&e.end>g(),De=e=>e.start>g()&&e.end<S(),j=e=>e.start<g()&&e.end>S(),Ce=e=>e.duration>p(),ne=(e,n)=>{if(!e)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof e=="string"){let o=document.querySelector(e);if(!o)throw new Error(`Selector could not be found [${l}]`);l=o}e instanceof HTMLElement&&(l=e),u=A({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-270000",timelineEnd:"1000y",start:"-1000y",end:"100y",minZoom:1,maxZoom:1e11,position:"bottom",expandRatio:80,eventHeight:5},n),N=K({title:"View",type:"container",start:u.start,end:u.end}),y=F(u.timelineStart),x=F(u.timelineEnd);let i=N.start,t=N.end;i<y&&(y=i),t>x&&(x=t);let r=t-i;a=R()/r,M=(y-i)/r,z=N,le(),ae(l),k()},Me=()=>{if(Y.length){let[e]=Y.slice(-1);return e}},R=()=>x-y,re=()=>l.offsetWidth||0,g=()=>y-p()*M,S=()=>g()+p(),p=()=>R()/a,ie=()=>u.zoomSpeed*a,E=e=>(e-g())/p(),$=e=>(e-y)/R(),oe=(e,n)=>{let i=a-n;return e===1&&i<=u.minZoom||e===-1&&i>=u.maxZoom?!1:(a=i,!0)},q=e=>{let n=M+e;n>=0&&(n=0),n+a<=1&&(n=1-a),M=n},O=(e,n)=>{let i=e*ie(),t=n*i;oe(e,i)&&q(t),k()},X=e=>{q(e*u.dragSpeed),k()},se=e=>{if(!e)return;let n=0,i=e.start-e.duration*.05,r=e.end+e.duration*.05-i,o=R()/r,m=Math.sign(a-o);if(m>0){let w=(g()+p()/2-i)/r,I=g()+p()*w;n=$(I)}else{let v=i+r/2,w=E(v),I=i+r*w;n=$(I)}let c=()=>{clearInterval(s);let v=setInterval(()=>{if(e.start<g()){X(10);return}if(e.end>S()){X(-10);return}clearInterval(v)},1)},s=setInterval(()=>{O(m,n),m<0&&a>o&&c(),m>0&&a<o&&c()},1)},ae=e=>{window.addEventListener("resize",()=>{k()},{passive:!0}),e.addEventListener("wheel",o=>{if(o.defaultPrevented)return;var m=Math.sign(o.deltaY);let v=((E(o.target.attributes.starttime)*e.getBoundingClientRect().width+o.offsetX)/re()-M)/a;O(m,v)},{passive:!0});let n,i,t=!1,r=!0;e.addEventListener("mousedown",o=>{t=!0,n=o.pageX,i=o.pageY},{passive:!0}),e.addEventListener("mousemove",o=>{if(!t||!r)return;r=!1;let m=o.pageX-n;m&&X(m),n=o.pageX,i=o.pageY,setTimeout(()=>r=!0,10)},{passive:!0}),e.addEventListener("mouseup",()=>{t=!1},{passive:!0})},G=e=>{if(!e||e.start>=S()||e.end<=g())return;let n=document.createDocumentFragment(),i=()=>{n.append(...e.children.reduce((o,m)=>{let T=G(V(A({},m),{level:e.level+(m.level-1)}));return T&&o.push(T),o},new Array))},t=o=>{let m=e.level*1.5,T=o?0:E(e.start),c=o?100:e.duration/p()*100,s=document.createElement("div"),v=e.color.map(w=>w-Math.pow(10,1));s.style.bottom=`${m*u.eventHeight}px`,s.style.minHeight=`${u.eventHeight}px`,s.style.borderRadius="5px",s.style.boxSizing="border-box",s.style.cursor="pointer",s.style.border=`1px solid rgba(${v.join(",")})`,s.style.backgroundColor=`rgb(${e.color.join(",")})`,s.style.zIndex=e.depth.toString(),s.addEventListener("click",w=>{s.dispatchEvent(new CustomEvent("event-click",{detail:e,bubbles:!0,cancelable:!0}))}),s.style.left=T*100+"%",s.style.width=c+"%",s.style.position="absolute",s.style.minWidth="5px",s.title=e.title,s.className="timelineEventGenerated",s.attributes.starttime=o?g():e.start,n.appendChild(s)},r=o=>{let m=o?0:E(e.start),T=o?100:e.duration/p()*100,c=document.createElement("div");c.style.left=m*100+"%",c.style.width=T+"%",c.style.position="absolute",c.style.minWidth="5px",c.style.overflow="hidden",c.style.bottom="0px",c.style.minHeight="100%",c.style.backgroundColor=`rgb(${e.color.join(",")})`,c.title=e.title,c.className="timelineEventGenerated",c.attributes.starttime=o?g():e.start,n.appendChild(c);let s=document.createElement("div");s.title=e.title,s.innerText=e.title,s.className="timelineEventGeneratedTitle",s.style.whiteSpace="nowrap",s.style.pointerEvents="none",s.style.userSelect="none",c.appendChild(s)};switch(e.type){case"container":i();break;case"timeline":{t(j(e));break}case"background":{r(j(e));break}}return n},le=()=>{l.style.position="relative",l.style.overflow="hidden",l.style.minHeight="3rem";let e=l.querySelector(".timelineHeaderContainer");H=e||document.createElement("div"),e||l.appendChild(H),H.className="timelineHeaderContainer",H.style.width="100%",H.style.height="20px",H.style.backgroundColor="white";let n=l.querySelector(".timelineLabelContainer");switch(d=n||document.createElement("div"),n||l.appendChild(d),d.className="timelineLabelContainer",d.style.width="100%",d.style.height="50px",d.style.textAlign="center",d.style.position="absolute",d.style.pointerEvents="none",d.style.userSelect="none",u.position){case"top":d.style.top="20px";break;default:d.style.bottom="0"}let i=l.querySelector(".timelineDividerContainer");f=i||document.createElement("div"),i||l.appendChild(f),f.className="timelineDividerContainer",f.style.width="100%",f.style.height="calc(100% - 20px)",f.style.position="absolute",f.style.zIndex="-2",f.style.bottom="0";let t=l.querySelector(".timelineEventsContainer");C=t||document.createElement("div"),t||l.appendChild(C),C.className="timelineEventsContainer",C.style.position="absolute",C.style.bottom="50px",C.style.height="calc(100% - 70px)",C.style.width="100%"},ce=e=>{let n=new Date(e*6e4);return p()<5760?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(n):p()<60480?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(n):p()<788923.1502?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short"}).format(n):n.getFullYear().toString()},k=()=>{if(!l)return;let e=Math.floor(a),n=Math.pow(2,Math.floor(Math.log2(e))),i=1/(u.labelCount+1),t=g()-y,o=R()*i/n,T=Math.floor(t/o)*o,c=document.createDocumentFragment(),s=document.createDocumentFragment();for(let w=0;w<u.labelCount+2;w++){let I=(w+1)*o+y+T-o,P=I+o/2,fe=E(I)*100,he=E(P)*100,D=document.createElement("div");D.className="timelineLabel",D.style.left=fe+"%",D.style.top="50%",D.style.transform="translate(calc(-50%), calc(-50%))",D.style.textAlign="center",D.style.position="absolute",D.style.zIndex="-1",D.style.width=i*100+"%",D.innerHTML=ce(I),c.appendChild(D);let L=document.createElement("div");L.className="timelineDivider",L.style.left=he+"%",L.style.textAlign="center",L.style.position="absolute",L.style.height="100%",L.style.zIndex="-10",L.innerHTML="",s.appendChild(L)}d.innerHTML="",d.appendChild(c),f.innerHTML="",f.appendChild(s);let v=G(z);C.innerHTML="",v&&C.appendChild(v),l.dispatchEvent(new CustomEvent("update",{detail:be(),bubbles:!0,cancelable:!0,composed:!1}))},F=e=>{if(e===void 0)return;let n=t=>{let r=new Date;if(r.setDate(t[2]?t[2]:1),r.setMonth(t[1]?t[1]-1:0),r.setHours(t[3]?t[3]:0),r.setMinutes(t[4]?t[4]:0),r.setSeconds(0),!t[0])return r.getTime()/6e4;if(t[0]&&t[0]>-27e4&&t[0]<27e4)return r.setFullYear(t[0]),r.getTime()/6e4;let o=525948.766*t[0];return r.setFullYear(0),o+r.getTime()/6e4},i=t=>{switch(t){case"now":return new Date;default:let r=Number(t.replace(/y$/,""));return isNaN(r)?new Date(t):new Date(Date.now()+31556926*1e3*r)}};if(Array.isArray(e)){let t=e;if(t.length===0)throw new Error("argument Array cannot be empty");if(!t.every(o=>typeof o=="number"))throw new Error("input Array must contain only numbers");return n(t)}if(typeof e=="object"&&e.constructor.name==="Date")return e.getTime()/6e4;if(typeof e=="string")return i(e).getTime()/6e4;if(typeof e=="number")return new Date(e).getTime()/6e4},de=e=>e.every(n=>typeof n=="number"),B=e=>e.start?e.children.length?Math.min(e.start,e.children[0].start):e.start:e.children.length?e.children[0].start:void 0,_=e=>e.end?e.end:e.duration&&!isNaN(Number(e.duration))?e.start+Number(e.duration):e.children.length&&e.children[e.children.length-1].end||e.start+1,ue=(e,n)=>{let i=0;for(let t in n.levelMatrix)if(i=Number(t),e.start>n.levelMatrix[t].time){for(let r=0;r<e.height;r++)n.levelMatrix[(i+r).toString()]={height:e.height,time:e.end};return i}i++;for(let t=0;t<e.height;t++)n.levelMatrix[(i+t).toString()]={height:e.height,time:e.end};return i},J=(e,...n)=>{let i=(r,o)=>r.duration/o.duration*r.children.length||1,t=n.map(r=>K(r,e)).filter(r=>!!r);t&&t.length&&e&&(e.children.push(...t),e.children.sort((r,o)=>r.start-o.start),e.start=B(e),e.end=_(e),e.duration=e.end-e.start,e.levelMatrix={1:{height:0,time:Number.MIN_SAFE_INTEGER}},e.children.forEach((r,o)=>{r.score=["container","timeline"].includes(r.type)?i(r,e):0,r.level=["container","timeline"].includes(r.type)?ue(r,e):0})),e.height=e.children.length?Math.max.apply(1,e.children.map(r=>r.level)):1},K=(e,n)=>{if(!e){console.warn("Event object is empty");return}let i=V(A({type:"timeline",duration:0,level:1,step:0,score:0,height:1,children:[],depth:n?n.depth+1:0},e),{color:e.color?de(e.color)?e.color:[140,140,140,e.type==="background"?.1:1]:[140,140,140,e.type==="background"?.1:1],start:F(e.start),end:F(e.end)});if(e.events&&e.events.length&&J(i,...e.events),i.start=B(i),!i.start){console.warn("Missing start property on event - skipping",e);return}return i.end=_(i),i.duration=i.end-i.start,i},me=e=>{let n=[],i=e.querySelectorAll(".timelineEvent");return i&&i.forEach(t=>{try{n.push(V(A({},t.attributes),{events:me(t)}))}catch(r){console.error(r,"timelineEvent")}}),n},be=()=>({options:u,viewStartDate:g(),viewEndDate:S(),viewDuration:p(),ratio:a,pivot:M});return ne(h,b),{focus:se,load:te,add:Z,current:z,element:l,on:ee}};export{He as Timeline};
