var le=Object.defineProperty,ce=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var J=(v,h,T)=>h in v?le(v,h,{enumerable:!0,configurable:!0,writable:!0,value:T}):v[h]=T,q=(v,h)=>{for(var T in h||(h={}))ue.call(h,T)&&J(v,T,h[T]);if(W)for(var T of W(h))me.call(h,T)&&J(v,T,h[T]);return v},P=(v,h)=>ce(v,de(h));var be=(v,h,T)=>{let b,k,N,V,m,u,g,w,C,R,S=[],M,K=(t,s,l)=>{if(!t)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof t=="string"){let o=document.querySelector(t);if(!o)throw new Error(`Selector could not be found [${m}]`);m=o}t instanceof HTMLElement&&(m=t),u=q({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-1000y",timelineEnd:"100y",minZoom:1,maxZoom:1e11,position:"bottom",expandRatio:80,eventHeight:5},l),M=B(s),S.push(M),N=$(u.timelineStart),V=$(u.timelineEnd);let n=u.viewStart?$(u.viewStart):M.start-M.duration*.05,a=u.viewEnd?$(u.viewEnd):M.end+M.duration*.05;n<N&&(N=n),a>V&&(V=a);let e=a-n;b=X()/e,k=(N-n)/e,ne(),ee(m),z()},I=()=>{let[t]=S.slice(-1);return t},X=()=>V-N,O=()=>m.offsetWidth||0,F=()=>N-L()*k,Z=()=>F()+L(),L=()=>X()/b,A=t=>(t-F())/L(),Q=(t,s)=>{let l=b-s;return t===1&&l<=u.minZoom||t===-1&&l>=u.maxZoom?!1:(b=l,!0)},j=t=>{let s=k+t;s>=0&&(s=0),s+b<=1&&(s=1-b),k=s},G=(t,s)=>{let l=u.zoomSpeed*b,n=t*l,o=((s||0)/O()-k)/b*n;Q(t,n)&&j(o),z()},U=t=>{j(t),z()},_=(t,s)=>{if(!t)return;let l=0,n=t.start-t.duration*.05,e=t.end+t.duration*.05-n,o=X()/e;if(s){let x=(F()+L()/2-n)/e*L(),i=F()+x;l=A(i)*O(),t.depth<I().depth&&(S.pop(),M=t)}else{let y=n+e/2,x=A(y)*e,i=n+x;l=A(i)*O()}let r=Math.sign(b-o),d=()=>{clearInterval(f),t.depth>I().depth&&S.push(t),t.depth==I().depth&&t!=I()&&(S.pop(),S.push(t)),z(),console.log(S)},f=setInterval(()=>{G(r,l),r<0&&b>o&&d(),r>0&&b<o&&d()},1)},ee=t=>{window.addEventListener("resize",()=>{z()},{passive:!0}),t.addEventListener("wheel",e=>{var o=Math.sign(e.deltaY);let d=(e.target.attributes.starttime?A(e.target.attributes.starttime):0)*t.getBoundingClientRect().width+e.offsetX;G(o,d)},{passive:!0});let s,l,n=!1,a=!0;t.addEventListener("mousedown",e=>{n=!0,s=e.pageX,l=e.pageY},{passive:!0}),t.addEventListener("mousemove",e=>{if(!n||!a)return;a=!1;let o=(e.pageX-s)*u.dragSpeed;o&&U(o),s=e.pageX,l=e.pageY,setTimeout(()=>a=!0,10)},{passive:!0}),t.addEventListener("mouseup",()=>{n=!1},{passive:!0})},te=t=>{let s=document.createDocumentFragment(),l=e=>{if(e.start>=Z()||e.end<=F())return;let o=A(e.start),r=document.createElement("div"),d=e.duration/L()*100;return r.style.left=o*100+"%",r.style.width=d+"%",r.style.position="absolute",r.style.minWidth="5px",r.title=e.title,r.className="timelineEventGenerated",r.attributes.starttime=e.start,r.attributes.expanded=d>u.expandRatio,r},n=e=>{let o=document.createElement("div");return o.title=e.title,o.innerText=e.title,o.className="timelineEventGeneratedTitle",o.style.whiteSpace="nowrap",o.style.pointerEvents="none",o.style.userSelect="none",o},a=e=>{if(!e.children.length)return;let o=document.createElement("div");return o.style.position="absolute",o.style.padding="2px",o.style.top="-23px",o.style.fontSize=".8rem",o.style.border="1px solid rgba(100, 100, 100, 0.5)",o.style.backgroundColor="white",o.style.zIndex=(e.depth+1).toString(),o.title="Expand timeline",o.innerHTML="Expand timeline &gt;",o.className="timelineEventExplode",o.addEventListener("click",r=>{r.stopImmediatePropagation(),r.preventDefault(),M=e,z(),console.log(M)}),o};if(!t.children.length)try{let e=l(t);if(e){let o=t.height+(t.height-1)*.5,r=t.level*1.5,d=t.color.map(f=>f-Math.pow(10,t.depth));e.style.bottom=`${r*u.eventHeight}px`,e.style.minHeight=`${o*u.eventHeight}px`,e.style.borderRadius="5px",e.style.boxSizing="border-box",e.style.border="1px solid rgba(100,100,100,.5)",e.style.backgroundColor=`rgb(${d[0]},${d[1]},${d[2]})`,e.style.zIndex=t.depth.toString(),t==I()?(t.children.length&&e.append(a(t)),e.style.opacity="1"):I().depth==t.depth&&(e.style.opacity=".2"),s.appendChild(e)}}catch(e){console.error(e,"timelineEvent",t)}return t.children.filter(e=>e.type==="background").forEach((e,o)=>{try{let r=l(e);if(r){let d=e.color.map(f=>f-Math.pow(10,e.depth));r.style.bottom="0px",r.style.minHeight="100%",r.style.backgroundColor=`rgba(${d[0]},${d[1]},${d[2]}, .05)`,r.addEventListener("click",f=>{r.dispatchEvent(new CustomEvent("background-event-click",{detail:e,bubbles:!0}))}),r.append(n(e)),s.appendChild(r)}}catch(r){console.error(r,"backgroundEvent",e)}}),t.children.filter(e=>e.type==="timeline").forEach((e,o)=>{try{let r=l(e);if(r){let d=e.height+(e.height-1)*.5,f=(e.level+t.level-1)*1.5,y=e.color.map(D=>D-Math.pow(10,e.depth));r.style.bottom=`${f*u.eventHeight}px`,r.style.minHeight=`${d*u.eventHeight}px`,r.style.borderRadius="5px",r.style.boxSizing="border-box",r.style.cursor="pointer",r.style.border="1px solid rgba(100,100,100,.5)",r.style.backgroundColor=`rgb(${y[0]},${y[1]},${y[2]})`,r.style.zIndex=e.depth.toString(),r.addEventListener("click",D=>{r.dispatchEvent(new CustomEvent("event-click",{detail:e,bubbles:!0,cancelable:!0}))}),e==I()?(e.children.length&&r.append(a(e)),r.style.opacity="1"):I().depth==e.depth&&(r.style.opacity=".2"),s.appendChild(r)}}catch(r){console.error(r,"timelineEvent",e)}}),s},ne=()=>{m.style.position="relative",m.style.overflow="hidden",m.style.minHeight="3rem";let t=m.querySelector(".timelineHeaderContainer");R=t||document.createElement("div"),t||m.appendChild(R),R.className="timelineHeaderContainer",R.style.width="100%",R.style.height="20px",R.style.backgroundColor="white";let s=m.querySelector(".timelineLabelContainer");switch(g=s||document.createElement("div"),s||m.appendChild(g),g.className="timelineLabelContainer",g.style.width="100%",g.style.height="50px",g.style.textAlign="center",g.style.position="absolute",g.style.pointerEvents="none",g.style.userSelect="none",u.position){case"top":g.style.top="20px";break;default:g.style.bottom="0"}let l=m.querySelector(".timelineDividerContainer");w=l||document.createElement("div"),l||m.appendChild(w),w.className="timelineDividerContainer",w.style.width="100%",w.style.height="calc(100% - 20px)",w.style.position="absolute",w.style.zIndex="-2",w.style.bottom="0";let n=m.querySelector(".timelineEventsContainer");C=n||document.createElement("div"),n||m.appendChild(C),C.className="timelineEventsContainer",C.style.position="absolute",C.style.bottom="50px",C.style.height="calc(100% - 70px)",C.style.width="100%"},re=t=>{let s=new Date(t*6e4);return L()<5760?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(s):L()<60480?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(s):L()<788923.1502?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short"}).format(s):s.getFullYear().toString()},z=()=>{if(!m)return;let t=Math.floor(b),s=Math.pow(2,Math.floor(Math.log2(t))),l=1/(u.labelCount+1),n=F()-N,e=X()*l/s,r=Math.floor(n/e)*e,d=document.createDocumentFragment(),f=document.createDocumentFragment();for(let i=0;i<u.labelCount+2;i++){let c=(i+1)*e+N+r-e,p=c+e/2,se=A(c)*100,ae=A(p)*100,H=document.createElement("div");H.className="timelineLabel",H.style.left=se+"%",H.style.top="50%",H.style.transform="translate(calc(-50%), calc(-50%))",H.style.textAlign="center",H.style.position="absolute",H.style.zIndex="-1",H.style.width=l*100+"%",H.innerHTML=re(c),d.appendChild(H);let E=document.createElement("div");E.className="timelineDivider",E.style.left=ae+"%",E.style.textAlign="center",E.style.position="absolute",E.style.height="100%",E.style.zIndex="-10",E.innerHTML="",f.appendChild(E)}g.innerHTML="",g.appendChild(d),w.innerHTML="",w.appendChild(f);let y=te(M);C.innerHTML="",C.appendChild(y);let D=document.createDocumentFragment(),x=document.createElement("div");if(x.className="timelineHeader",x.style.textAlign="center",x.innerHTML=I().title,D.appendChild(x),S.length>1){let i=document.createElement("div");i.className="timelineBack",i.style.position="absolute",i.style.top="0px",i.style.left="5px",i.style.cursor="pointer",i.innerHTML="<",i.addEventListener("click",c=>{i.dispatchEvent(new CustomEvent("back-click",{bubbles:!0}));let[p]=S.slice(-2);_(p,!0)}),D.appendChild(i)}R.innerHTML="",R.appendChild(D),m.dispatchEvent(new CustomEvent("update",{detail:oe(),bubbles:!0,cancelable:!0,composed:!1}))},$=t=>{if(t===void 0)return;let s=n=>{let a=new Date;if(a.setDate(n[2]?n[2]:1),a.setMonth(n[1]?n[1]-1:0),a.setHours(n[3]?n[3]:0),a.setMinutes(n[4]?n[4]:0),a.setSeconds(0),!n[0])return a.getTime()/6e4;if(n[0]&&n[0]>-27e4&&n[0]<27e4)return a.setFullYear(n[0]),a.getTime()/6e4;let e=525948.766*n[0];return a.setFullYear(0),e+a.getTime()/6e4},l=n=>{switch(n){case"now":return new Date;default:let a=Number(n.replace(/y$/,""));return isNaN(a)?new Date(n):new Date(Date.now()+31556926*1e3*a)}};if(Array.isArray(t)){let n=t;if(n.length===0)throw new Error("argument Array cannot be empty");if(!n.every(e=>typeof e=="number"))throw new Error("input Array must contain only numbers");return s(n)}if(typeof t=="object"&&t.constructor.name==="Date")return t.getTime()/6e4;if(typeof t=="string")return l(t).getTime()/6e4;if(typeof t=="number")return new Date(t).getTime()/6e4},B=(t,s)=>{if(!t){console.warn("Event object is empty");return}let l=i=>i.every(c=>typeof c=="number"),n=P(q({type:"timeline",duration:0,color:[240,240,240],expanded:!1,level:0,step:0,score:0,height:0,children:[],depth:s?s.depth+1:0},t),{start:$(t.start),end:$(t.end)}),a=t.events?t.events.reduce((i,c)=>{let p=B(c,n);return p&&i.push(p),i},[]):[];n.children=a.sort((i,c)=>i.start-c.start);let e=n.start?n.children.length?Math.min(n.start,n.children[0].start):n.start:n.children.length?n.children[0].start:void 0;if(!e){console.warn("Missing start property on event - skipping",t);return}let o=n.end?n.end:n.duration&&!isNaN(Number(n.duration))?e+Number(n.duration):n.children.length&&n.children[n.children.length-1].end||e+1,r=t.color?l(t.color)?t.color:[240,240,240]:[240,240,240],d={1:{height:0,time:Number.MIN_SAFE_INTEGER}},f=i=>{let c=0;for(let p in d)if(c=Number(p),i.start>d[p].time){for(let Y=0;Y<i.height;Y++)d[(c+Y).toString()]={height:i.height,time:i.end};return c}c++;for(let p=0;p<i.height;p++)d[(c+p).toString()]={height:i.height,time:i.end};return c},y={1:{height:0,time:Number.MIN_SAFE_INTEGER}},D=i=>{let c=0;for(let p in y)if(c=Number(p),i.start>y[p].time)return y[c.toString()]={height:i.height,time:i.end},c;return c++,y[c.toString()]={height:i.height,time:i.end},c},x=i=>{let c=1;return c=(i.duration||1)/X()*n.children.length,c};return n.children.forEach((i,c)=>{i.score=x(i),i.level=i.type==="timeline"?f(i):0,i.step=i.type==="timeline"?D(i):0}),n.type=t.type||"timeline",n.duration=o-e,n.color=r,n.start=e,n.end=o,n.height=a.length?Math.max.apply(1,a.map(i=>i.level)):1,n},ie=t=>{let s=[],l=t.querySelectorAll(".timelineEvent");return l&&l.forEach(n=>{try{s.push(P(q({},n.attributes),{events:ie(n)}))}catch(a){console.error(a,"timelineEvent")}}),s},oe=()=>({options:u,viewStartDate:F(),viewEndDate:Z(),viewDuration:L(),ratio:b,pivot:k});return K(v,h,T),{focus:_}};export{be as Timeline};
