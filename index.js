var ge=Object.defineProperty,he=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var Q=(h,b,a)=>b in h?ge(h,b,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[b]=a,F=(h,b)=>{for(var a in b||(b={}))pe.call(b,a)&&Q(h,a,b[a]);if(K)for(var a of K(b))ve.call(b,a)&&Q(h,a,b[a]);return h},z=(h,b)=>he(h,ye(b));var U=(h,b,a)=>new Promise((T,w)=>{var H=l=>{try{u(a.next(l))}catch(g){w(g)}},c=l=>{try{u(a.throw(l))}catch(g){w(g)}},u=l=>l.done?T(l.value):Promise.resolve(l.value).then(H,c);u((a=a.apply(h,b)).next())});var Le=(h,b)=>{let a,T,w,H,c,u,l,g,C,X,E,W=(e,n)=>{c.addEventListener(e,n,!0)},ee=e=>U(void 0,null,function*(){if(!e)throw new Error("Argument is empty. Please provide a loader function as first arg");P(yield e())}),P=e=>{if(!e)throw new Error("Event argument is empty. Please provide Timeline event as first arg");_(E,e),k()},Te=e=>e.start<R()&&e.end>y(),we=e=>e.start>y()&&e.end<R(),Y=e=>e.start<y()&&e.end>R(),De=e=>e.duration>p(),te=(e,n)=>{if(!e)throw new Error("Element argument is empty. DOM element | selector as first arg");if(typeof e=="string"){let o=document.querySelector(e);if(!o)throw new Error(`Selector could not be found [${c}]`);c=o}e instanceof HTMLElement&&(c=e),u=F({labelCount:5,zoomSpeed:.025,dragSpeed:.001,timelineStart:"-270000",timelineEnd:"1000y",start:"-1000y",end:"100y",minZoom:1,maxZoom:1e11,position:"bottom",expandRatio:80,eventHeight:5},n),E=J({title:"View",type:"container",start:u.start,end:u.end}),w=A(u.timelineStart),H=A(u.timelineEnd);let r=E.start,t=E.end;r<w&&(w=r),t>H&&(H=t);let i=t-r;a=N()/i,T=(w-r)/i,X=E,ae(),se(c),k()},N=()=>H-w,ne=()=>c.offsetWidth||0,y=()=>w-p()*T,R=()=>y()+p(),p=()=>N()/a,re=()=>u.zoomSpeed*a,S=e=>(e-y())/p(),Z=e=>(e-w)/N(),ie=(e,n)=>{let r=a-n;return e===1&&r<=u.minZoom||e===-1&&r>=u.maxZoom?!1:(a=r,!0)},j=e=>{let n=T+e;n>=0&&(n=0),n+a<=1&&(n=1-a),T=n},$=(e,n)=>{let r=e*re(),t=n*r;ie(e,r)&&j(t),k()},O=e=>{j(e*u.dragSpeed),k()},oe=e=>{if(!e)return;let n=0,r=e.duration*.05,t=e.start-r,o=e.end+r-t,m=N()/o,f=Math.sign(a-m);if(f>0){let D=(y()+p()/2-t)/o,I=y()+p()*D;n=Z(I)}else{let v=t+o/2,D=S(v),I=t+o*D;n=Z(I)}let s=()=>{clearInterval(L);let v=T-(t-y())/p(),D=Math.sign(v-T),I=()=>{clearInterval(V),c.dispatchEvent(new CustomEvent("event-focus",{detail:e,bubbles:!0,cancelable:!0}))},V=setInterval(()=>{O(D*10),D<0&&T<v&&I(),D>0&&T>v&&I()},1)},L=setInterval(()=>{$(f,n),f<0&&a>m&&s(),f>0&&a<m&&s()},1)},se=e=>{window.addEventListener("resize",()=>{k()},{passive:!0}),e.addEventListener("wheel",o=>{if(o.defaultPrevented)return;var m=Math.sign(o.deltaY);let L=(((o.target.attributes.starttime?S(o.target.attributes.starttime):0)*e.getBoundingClientRect().width+o.offsetX)/ne()-T)/a;$(m,L)},{passive:!0});let n,r,t=!1,i=!0;e.addEventListener("mousedown",o=>{t=!0,n=o.pageX,r=o.pageY},{passive:!0}),e.addEventListener("mousemove",o=>{if(!t||!i)return;i=!1;let m=o.pageX-n;m&&O(m),n=o.pageX,r=o.pageY,setTimeout(()=>i=!0,10)},{passive:!0}),e.addEventListener("mouseup",()=>{t=!1},{passive:!0})},q=e=>{if(!e||e.start>=R()||e.end<=y())return;let n=document.createDocumentFragment(),r=()=>{n.append(...e.children.reduce((o,m)=>{let f=q(z(F({},m),{level:e.level+(m.level-1)}));return f&&o.push(f),o},new Array))},t=o=>{let m=e.level*1.5,f=o?0:S(e.start),d=o?100:e.duration/p()*100,s=document.createElement("div"),L=e.color.map(v=>v-Math.pow(10,1));s.style.bottom=`${m*u.eventHeight}px`,s.style.minHeight=`${u.eventHeight}px`,s.style.borderRadius="5px",s.style.boxSizing="border-box",s.style.cursor="pointer",s.style.border=`1px solid rgba(${L.join(",")})`,s.style.backgroundColor=`rgb(${e.color.join(",")})`,s.style.zIndex=e.depth.toString(),s.addEventListener("click",v=>{s.dispatchEvent(new CustomEvent("event-click",{detail:e,bubbles:!0,cancelable:!0}))}),s.style.left=f*100+"%",s.style.width=d+"%",s.style.position="absolute",s.style.minWidth="5px",s.title=e.title,s.className="timelineEventGenerated",s.attributes.starttime=o?y():e.start,n.appendChild(s)},i=o=>{let m=o?0:S(e.start),f=o?100:e.duration/p()*100,d=document.createElement("div");d.style.left=m*100+"%",d.style.width=f+"%",d.style.position="absolute",d.style.minWidth="5px",d.style.overflow="hidden",d.style.bottom="0px",d.style.minHeight="100%",d.style.backgroundColor=`rgb(${e.color.join(",")})`,d.title=e.title,d.className="timelineEventGenerated",d.attributes.starttime=o?y():e.start,n.appendChild(d);let s=document.createElement("div");s.title=e.title,s.innerText=e.title,s.className="timelineEventGeneratedTitle",s.style.whiteSpace="nowrap",s.style.pointerEvents="none",s.style.userSelect="none",d.appendChild(s)};switch(e.type){case"container":r();break;case"timeline":{t(Y(e));break}case"background":{i(Y(e));break}}return n},ae=()=>{c.style.position="relative",c.style.overflow="hidden",c.style.minHeight="3rem";let e=c.querySelector(".timelineLabelContainer");switch(l=e||document.createElement("div"),e||c.appendChild(l),l.className="timelineLabelContainer",l.style.width="100%",l.style.height="50px",l.style.textAlign="center",l.style.position="absolute",l.style.pointerEvents="none",l.style.userSelect="none",u.position){case"top":l.style.top="0";break;default:l.style.bottom="0"}let n=c.querySelector(".timelineDividerContainer");g=n||document.createElement("div"),n||c.appendChild(g),g.className="timelineDividerContainer",g.style.width="100%",g.style.height="100%",g.style.position="absolute",g.style.zIndex="-2",g.style.bottom="0";let r=c.querySelector(".timelineEventsContainer");C=r||document.createElement("div"),r||c.appendChild(C),C.className="timelineEventsContainer",C.style.position="absolute",C.style.bottom="50px",C.style.height="calc(100% - 50px)",C.style.width="100%"},le=e=>{let n=new Date(e*6e4);return p()<5760?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(n):p()<60480?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(n):p()<788923.1502?Intl.DateTimeFormat(void 0,{year:"numeric",month:"short"}).format(n):n.getFullYear().toString()},k=()=>{if(!c)return;let e=Math.floor(a),n=Math.pow(2,Math.floor(Math.log2(e))),r=1/(u.labelCount+1),t=y()-w,o=N()*r/n,f=Math.floor(t/o)*o,d=document.createDocumentFragment(),s=document.createDocumentFragment();for(let v=0;v<u.labelCount+2;v++){let D=(v+1)*o+w+f-o,I=D+o/2,be=S(D)*100,fe=S(I)*100,M=document.createElement("div");M.className="timelineLabel",M.style.left=be+"%",M.style.top="50%",M.style.transform="translate(calc(-50%), calc(-50%))",M.style.textAlign="center",M.style.position="absolute",M.style.zIndex="-1",M.style.width=r*100+"%",M.innerHTML=le(D),d.appendChild(M);let x=document.createElement("div");x.className="timelineDivider",x.style.left=fe+"%",x.style.textAlign="center",x.style.position="absolute",x.style.height="100%",x.style.zIndex="-10",x.innerHTML="",s.appendChild(x)}l.innerHTML="",l.appendChild(d),g.innerHTML="",g.appendChild(s);let L=q(X);C.innerHTML="",L&&C.appendChild(L),c.dispatchEvent(new CustomEvent("update",{detail:me(),bubbles:!0,cancelable:!0,composed:!1}))},A=e=>{if(e===void 0)return;let n=t=>{let i=new Date;if(i.setDate(t[2]?t[2]:1),i.setMonth(t[1]?t[1]-1:0),i.setHours(t[3]?t[3]:0),i.setMinutes(t[4]?t[4]:0),i.setSeconds(0),!t[0])return i.getTime()/6e4;if(t[0]&&t[0]>-27e4&&t[0]<27e4)return i.setFullYear(t[0]),i.getTime()/6e4;let o=525948.766*t[0];return i.setFullYear(0),o+i.getTime()/6e4},r=t=>{switch(t){case"now":return new Date;default:let i=Number(t.replace(/y$/,""));return isNaN(i)?new Date(t):new Date(Date.now()+31556926*1e3*i)}};if(Array.isArray(e)){let t=e;if(t.length===0)throw new Error("argument Array cannot be empty");if(!t.every(o=>typeof o=="number"))throw new Error("input Array must contain only numbers");return n(t)}if(typeof e=="object"&&e.constructor.name==="Date")return e.getTime()/6e4;if(typeof e=="string")return r(e).getTime()/6e4;if(typeof e=="number")return new Date(e).getTime()/6e4},ce=e=>e.every(n=>typeof n=="number"),G=e=>e.start?e.children.length?Math.min(e.start,e.children[0].start):e.start:e.children.length?e.children[0].start:void 0,B=e=>e.end?e.end:e.duration&&!isNaN(Number(e.duration))?e.start+Number(e.duration):e.children.length&&e.children[e.children.length-1].end||e.start+1,de=(e,n)=>{let r=0;for(let t in n.levelMatrix)if(r=Number(t),e.start>n.levelMatrix[t].time){for(let i=0;i<e.height;i++)n.levelMatrix[(r+i).toString()]={height:e.height,time:e.end};return r}r++;for(let t=0;t<e.height;t++)n.levelMatrix[(r+t).toString()]={height:e.height,time:e.end};return r},_=(e,...n)=>{let r=(i,o)=>i.duration/o.duration*i.children.length||1,t=n.map(i=>J(i,e)).filter(i=>!!i);t&&t.length&&e&&(e.children.push(...t),e.children.sort((i,o)=>i.start-o.start),e.start=G(e),e.end=B(e),e.duration=e.end-e.start,e.levelMatrix={1:{height:0,time:Number.MIN_SAFE_INTEGER}},e.children.forEach((i,o)=>{i.score=["container","timeline"].includes(i.type)?r(i,e):0,i.level=["container","timeline"].includes(i.type)?de(i,e):0})),e.height=e.children.length?Math.max.apply(1,e.children.map(i=>i.level)):1},J=(e,n)=>{if(!e){console.warn("Event object is empty");return}let r=z(F({type:"timeline",duration:0,level:1,step:0,score:0,height:1,children:[],depth:n?n.depth+1:0},e),{color:e.color?ce(e.color)?e.color:[140,140,140,e.type==="background"?.1:1]:[140,140,140,e.type==="background"?.1:1],start:A(e.start),end:A(e.end)});if(e.events&&e.events.length&&_(r,...e.events),r.start=G(r),!r.start){console.warn("Missing start property on event - skipping",e);return}return r.end=B(r),r.duration=r.end-r.start,r},ue=e=>{let n=[],r=e.querySelectorAll(".timelineEvent");return r&&r.forEach(t=>{try{n.push(z(F({},t.attributes),{events:ue(t)}))}catch(i){console.error(i,"timelineEvent")}}),n},me=()=>({options:u,viewStartDate:y(),viewEndDate:R(),viewDuration:p(),ratio:a,pivot:T});return te(h,b),{focus:oe,load:ee,add:P,on:W}};export{Le as Timeline};
